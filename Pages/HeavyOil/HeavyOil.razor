@page "/home/heavyoil"

<PageTitle>Heavy Oil</PageTitle>

<div id="myDiagramDiv" 
     style="width:100%; height:calc(100vh - 140px); 
            border:1px solid lightgray; 
            margin:70px auto;">
</div>

<script src="https://unpkg.com/gojs/release/go.js"></script>

<script>
    function init() {
        const $ = go.GraphObject.make;
        const myDiagram = $(go.Diagram, "myDiagramDiv", {
            "undoManager.isEnabled": true
        });

        function cgsClick(e, obj) {
            const data = obj.part.data;
            if (data && data.key) {
                window.location.href = `/home/heavyoil/cgs/${data.key}`;
            }
        }

        // Template CGS aktif
        myDiagram.nodeTemplateMap.add("CGS",
            $(go.Node, "Vertical",
                { locationSpot: go.Spot.Center, click: cgsClick },
                $(go.Picture,
                    { width: 40, height: 40, margin: 2 },
                    new go.Binding("source", "icon")),
                $(go.TextBlock, { font: "bold 12px sans-serif", margin: 2 },
                    new go.Binding("text", "name")),
                $(go.TextBlock, "Total Anomalies",
                    { font: "10px sans-serif", stroke: "gray" }),
                $(go.TextBlock,
                    { font: "bold 12px sans-serif" },
                    new go.Binding("text", "anomalies")),
                $(go.TextBlock,
                    { font: "italic 11px sans-serif", stroke: "gray" },
                    new go.Binding("text", "status"))
            )
        );

        // Template CGS inactive
        myDiagram.nodeTemplateMap.add("CGS_inactive",
            $(go.Node, "Vertical",
                { locationSpot: go.Spot.Center, click: cgsClick },
                $(go.Picture,
                    { width: 40, height: 40, margin: 2 },
                    new go.Binding("source", "icon")),
                $(go.TextBlock, { font: "bold 12px sans-serif", margin: 2 },
                    new go.Binding("text", "name")),
                $(go.TextBlock, "Total Anomalies",
                    { font: "10px sans-serif", stroke: "gray" }),
                $(go.TextBlock,
                    { font: "bold 12px sans-serif" },
                    new go.Binding("text", "anomalies")),
                $(go.TextBlock,
                    { font: "italic 11px sans-serif", stroke: "gray" },
                    new go.Binding("text", "status"))
            )
        );

        // Template Tank Farm
        myDiagram.nodeTemplateMap.add("TankFarm",
            $(go.Node, "Vertical",
                { locationSpot: go.Spot.Center },
                $(go.Picture,
                    { width: 60, height: 60, margin: 2 },
                    new go.Binding("source", "icon")),
                $(go.TextBlock, { font: "bold 12px sans-serif", margin: 2 },
                    new go.Binding("text", "name"))
            )
        );

        // Template untuk junction points (titik pertemuan pipa)
        myDiagram.nodeTemplateMap.add("Junction",
            $(go.Node,
                { locationSpot: go.Spot.Center },
                $(go.Shape, "Circle",
                    { width: 8, height: 8, fill: "black", stroke: null })
            )
        );

        // Link style (pipa)
        myDiagram.linkTemplate =
            $(go.Link,
                { routing: go.Link.Orthogonal, corner: 0, selectable: false },
                $(go.Shape, { strokeWidth: 6, stroke: "black" }),
                new go.Binding("toArrow", "arrow")
            );

        // Data node
        myDiagram.model = new go.GraphLinksModel(
            [
                { key: 1, category: "CGS", name: "CGS 1", anomalies: "67.68%", status: "14 Total Anomalies", icon: "./Asset/tank.png", loc: "-300 -150" },
                { key: 2, category: "CGS", name: "CGS 3", anomalies: "82.30%", status: "17 Total Anomalies", icon: "./Asset/tank.png", loc: "-100 -150" },
                { key: 3, category: "CGS", name: "CGS 5", anomalies: "69.97%", status: "24 Total Anomalies", icon: "./Asset/tank.png", loc: "-200 150" },
                { key: 4, category: "CGS_inactive", name: "CGS 4 - inactive", anomalies: "", status: "", icon: "./Asset/tank.png", loc: "100 -150" },
                { key: 5, category: "CGS", name: "CGS 10", anomalies: "71.56%", status: "17 Total Anomalies", icon: "./Asset/tank.png", loc: "200 150" },
                { key: 6, category: "TankFarm", name: "Dumai Tank Farm", icon: "./Asset/DumaiTankFarm.png", loc: "400 0" },
                { key: 101, category: "Junction", loc: "-150 -50" },
                { key: 102, category: "Junction", loc: "-50 -50" },
                { key: 103, category: "Junction", loc: "50 -50" },
                { key: 104, category: "Junction", loc: "200 -50" }
            ],
            [
                { from: 1, to: 101 },
                { from: 2, to: 101 },
                { from: 101, to: 102 },
                { from: 3, to: 102 },
                { from: 102, to: 103 },
                { from: 4, to: 103 },
                { from: 103, to: 104 },
                { from: 5, to: 104 },
                { from: 104, to: 6, arrow: "Standard" }
            ]
        );

        myDiagram.nodes.each(function (n) {
            var d = n.data;
            if (d.loc) n.position = go.Point.parse(d.loc);
        });
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
</script>
