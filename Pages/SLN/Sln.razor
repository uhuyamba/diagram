@page "/home/sln"

<PageTitle>Sumatra Light North</PageTitle>

<div id="myDiagramDiv" style="width:100%; height:calc(100vh - 140px);
                border:1px solid lightgray;
                margin:70px auto;">
</div>

<script src="https://unpkg.com/gojs/release/go.js"></script>

<script>
(function() {
    const $ = go.GraphObject.make;

    const diagram = $(go.Diagram, "myDiagramDiv", {
        initialContentAlignment: go.Spot.Center,
        "undoManager.isEnabled": true
    });

    function perfColor(p) {
      if (p >= 90) return "#2e7d32";       
      if (p >= 85) return "#fbc02d";       
      if (p >= 75) return "#ef6c00";     
      return "#c62828";                   
    }

    function PercentPanel() {
      return $(go.Panel, "Auto",
        { margin: new go.Margin(4, 0, 0, 0) },
        $(go.Shape, "RoundedRectangle",
          { stroke: null, parameter1: 6, height: 26, minSize: new go.Size(88, 26) },
          new go.Binding("fill", "percent", p => perfColor(+p))
        ),
        $(go.TextBlock,
          { font: "bold 11px sans-serif", stroke: "white", margin: 6, textAlign: "center" },
          new go.Binding("text", "percent", p => (+p).toFixed(2) + "%")
        )
      );
    }

    const GSTemplate =
      $(go.Node, "Vertical",
        { locationSpot: go.Spot.Center, selectionAdorned: false },
        $(go.Panel, "Horizontal",
          $(go.Shape, "TriangleUp", { width: 14, height: 14, fill: "#777", stroke: null, margin: 2 }),
          $(go.TextBlock, { font: "bold 12px sans-serif", margin: new go.Margin(0,0,0,4) },
            new go.Binding("text", "name"))
        ),
        $(go.Picture, { width: 24, height: 24, margin: 2 },
            new go.Binding("source", "icon")),
        $(go.TextBlock, { font: "10px sans-serif", stroke: "#555" },
          new go.Binding("text", "anoms", n => n + " Total Anomalies")),
        PercentPanel(),
        new go.Binding("position", "loc", go.Point.parse).makeTwoWay(go.Point.stringify)
      );

    const StationTemplate =
      $(go.Node, "Vertical",
        { locationSpot: go.Spot.Center, selectionAdorned: false },
        $(go.Shape, "Circle", { width: 42, height: 42, fill: "#90caf9", stroke: "#1565c0", strokeWidth: 1.2 }),
        $(go.TextBlock, { font: "bold 11px sans-serif", margin: 4 },
            new go.Binding("text", "name")),
        $(go.Picture, { width: 24, height: 24, margin: 2 },
            new go.Binding("source", "icon")),
        new go.Binding("position", "loc", go.Point.parse).makeTwoWay(go.Point.stringify)
      );

    const JunctionTemplate =
      $(go.Node, "Vertical",
        { locationSpot: go.Spot.Center, selectable: false },
        $(go.Shape, "Circle", { width: 8, height: 8, fill: "black", stroke: null }),
        $(go.Picture, { width: 24, height: 24, margin: 2 },
            new go.Binding("source", "icon")),
        new go.Binding("position", "loc", go.Point.parse)
      );

    diagram.nodeTemplateMap.add("GS", GSTemplate);
    diagram.nodeTemplateMap.add("Station", StationTemplate);
    diagram.nodeTemplateMap.add("Junction", JunctionTemplate);

    diagram.linkTemplate = $(go.Link, {
        routing: go.Link.AvoidsNodes,
        corner: 8,
        toShortLength: 3,
        selectable: false
      },
      $(go.Shape, { strokeWidth: 4, stroke: "#333" }),
      $(go.Shape, { toArrow: "Standard", stroke: null, fill: "#333" })
    );

    const nodes = [
      { key: "pinang", category: "GS", name: "Pinang GS", anoms: 1, percent: 89.58, icon: "./asset/tank.png", loc: "-720 -300" },
      { key: "bangko", category: "GS", name: "Bangko GS", anoms: 1, percent: 89.29, icon: "./asset/tank.png", loc: "-540 -300" },
      { key: "seruni", category: "GS", name: "Seruni GS", anoms: 3, percent: 80.00, icon: "./asset/tank.png", loc: "-360 -300" },
      { key: "sintong", category: "GS", name: "Sintong GS", anoms: 3, percent: 75.00, icon: "./asset/tank.png", loc: "-180 -300" },
      { key: "pager", category: "GS", name: "Pager GS", anoms: 1, percent: 93.13, icon: "./asset/tank.png", loc: "  20 -300" },
      { key: "benar", category: "GS", name: "Benar GS", anoms: 2, percent: 90.44, icon: "./asset/tank.png", loc: " 200 -300" },
      { key: "rantau", category: "GS", name: "Rantau Bais GS", anoms: 2, percent: 76.56, icon: "./asset/tank.png", loc: " 380 -300" },
      { key: "dumai", category: "Station", name: "Dumai Tank Farm", icon: "./Asset/DumaiTankFarm.png", loc: " 720 -280" },

      { key: "meno", category: "GS", name: "MeNo GS", anoms: 2, percent: 85.00, icon: "./asset/tank.png", loc: "-480 -100" },
      { key: "meso", category: "GS", name: "MeSo GS", anoms: 2, percent: 82.81, icon: "./asset/tank.png", loc: "-360 -100" },
      { key: "puncak", category: "GS", name: "Puncak GS", anoms: 1, percent: 88.89, icon: "./asset/tank.png", loc: "  80 -100" },
      { key: "pemburu", category: "GS", name: "Pemburu GS", anoms: 0, percent: 97.73, icon: "./asset/tank.png", loc: " 260 -100" },

      { key: "cps", category: "Station", name: "CPS Duri", icon: "./asset/cps-duri.svg", loc: " 220  80" },

      { key: "ampuh", category: "GS", name: "Ampuh GS", anoms: 2, percent: 77.78, icon: "./asset/tank.png", loc: "-720  260" },
      { key: "rangau", category: "GS", name: "Rangau GS", anoms: 0, percent: 68.75, icon: "./asset/tank.png", loc: "-540  260" },
      { key: "petani", category: "GS", name: "Petani GS", anoms: 2, percent: 70.19, icon: "./asset/tank.png", loc: "-360  260" },
      { key: "pematang", category: "GS", name: "Pematang GS", anoms: 1, percent: 91.45, icon: "./asset/tank.png", loc: "-160  260" },
      { key: "bekasap", category: "GS", name: "Bekasap GS", anoms: 3, percent: 70.14, icon: "./asset/tank.png", loc: "  40  260" },

      { key: "intan", category: "GS", name: "Intan GS", anoms: 5, percent: 66.35, icon: "./asset/tank.png", loc: " 260  260" },
      { key: "pungut", category: "GS", name: "Pungut GS", anoms: 2, percent: 89.29, icon: "./asset/tank.png", loc: " 460  260" },
      { key: "tandum", category: "GS", name: "Tandun GS", anoms: 0, percent: 94.44, icon: "./asset/tank.png", loc: " 640  260" },
      { key: "libo", category: "GS", name: "Libo GS", anoms: 2, percent: 77.94, icon: "./asset/tank.png", loc: " 820  260" },

      { key: "j1", category: "Junction", loc: "-450 -220" }, 
      { key: "j2", category: "Junction", loc: " 500 -220" }, 
      { key: "j3", category: "Junction", loc: " 720   60" }, 
      { key: "j4", category: "Junction", loc: "  80 -220" }, 
      { key: "j5", category: "Junction", loc: " 220   160" }, 
      { key: "j6", category: "Junction", loc: " -80  160" }, 
      { key: "j7", category: "Junction", loc: " 480  160" }  
    ];

    const links = [
      { from: "pinang", to: "bangko" },
      { from: "bangko", to: "seruni" },
      { from: "seruni", to: "sintong" },
      { from: "sintong", to: "pager" },
      { from: "pager", to: "benar" },
      { from: "benar", to: "rantau" },
      { from: "rantau", to: "j2" },
      { from: "j2", to: "dumai" },

      { from: "seruni", to: "j1" },
      { from: "j1", to: "meno" },
      { from: "meno", to: "meso" },

      { from: "benar", to: "j4" },
      { from: "j4", to: "puncak" },
      { from: "puncak", to: "pemburu" },
      { from: "pemburu", to: "j5" },
      { from: "j5", to: "cps" },

      { from: "ampuh", to: "rangau" },
      { from: "rangau", to: "petani" },
      { from: "petani", to: "pematang" },
      { from: "pematang", to: "bekasap" },
      { from: "bekasap", to: "j6" },
      { from: "j6", to: "cps" },

      { from: "cps", to: "j7" },
      { from: "j7", to: "intan" },
      { from: "intan", to: "pungut" },
      { from: "pungut", to: "tandum" },
      { from: "tandum", to: "libo" },

      { from: "libo", to: "j3" },
      { from: "j3", to: "dumai" }
    ];

    diagram.model = new go.GraphLinksModel(nodes, links);

  })();
</script>
